<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>thynkBarber • Vendas (Barbeiro)</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {25:'#f8faff',50:'#f3f7ff',100:'#e6efff',200:'#d8e6ff',300:'#b9d0ff',400:'#93b4ff',500:'#4a82ff',600:'#3a6af4',700:'#2e54c6',800:'#2746a3',900:'#203a85'}
          },
          boxShadow:{ soft:'0 1px 2px rgba(16,24,40,.04), 0 6px 18px rgba(16,24,40,.08)' },
          borderRadius:{ '2xl':'1rem' },
          keyframes:{ fadeUp:{ from:{opacity:0, transform:'translateY(6px)'}, to:{opacity:1, transform:'translateY(0)'} }, slideIn:{ from:{transform:'translateX(100%)'}, to:{transform:'translateX(0)'} } },
          animation:{ fadeUp:'fadeUp .28s ease both', slideIn:'slideIn .25s ease both' }
        }
      }
    }
  </script>

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    *{ box-sizing:border-box }
    html, body{ overflow-x:hidden; background:#fff }
    .tap{ min-height:44px; min-width:44px }
    .no-scrollbar::-webkit-scrollbar{ display:none }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none }
    input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{ -webkit-appearance: none; margin:0 }
    input[type=number]{ -moz-appearance:textfield }
  </style>
</head>
<body class="bg-white text-slate-800">

  <!-- TOPBAR (mobile) -->
  <header class="lg:hidden sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
    <div class="flex items-center gap-2 p-3">
      <button id="openSidebar" class="tap p-2 rounded-xl border hover:bg-slate-50" aria-label="Abrir menu">
        <i class="bi bi-list"></i>
      </button>
      <div class="font-medium">Vendas</div>
      <div class="ml-auto text-xs px-2 py-1 rounded bg-slate-100">Light</div>
    </div>
  </header>

  <div class="flex">
    <!-- SIDEBAR (desktop fixa) -->
    <aside class="hidden lg:flex lg:fixed lg:inset-y-0 lg:left-0 lg:w-72 border-r bg-white z-40">
      <div class="flex-1 flex flex-col">
        <div class="px-5 py-5 border-b flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-brand-600 text-white grid place-items-center font-bold">tb</div>
          <div>
            <div class="font-bold">thynkBarber</div>
            <div class="text-xs text-slate-500">Painel do Barbeiro</div>
          </div>
        </div>
        <nav class="px-3 py-3 text-sm overflow-y-auto">
          <div class="px-3 py-2 text-slate-400 uppercase tracking-wide">Administrativo</div>
          <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-speedometer2"></i><span>Dashboard</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Agendamentos</div>
          <a href="agenda.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-calendar3"></i><span>Agendamentos</span>
          </a>
          <a href="historico.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-clock-history"></i><span>Histórico</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Finanças</div>
          <a href="faturamento.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-wallet2"></i><span>Faturamento</span>
          </a>
          <a href="metas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bullseye"></i><span>Metas</span>
          </a>
          <a href="vendas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl bg-brand-50 text-brand-800 border border-brand-100">
            <i class="bi bi-bag"></i><span>Vendas</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Perfil</div>
          <div class="mx-3 p-3 border rounded-xl bg-slate-50">
            <div class="text-xs text-slate-500">Barbeiro</div>
            <div id="barberName" class="font-medium">—</div>
          </div>
        </nav>
      </div>
    </aside>

    <!-- SIDEBAR (mobile offcanvas) -->
    <div id="sidebarSheet" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-black/40" data-close-sheet></div>
      <div class="absolute left-0 top-0 h-full w-[92%] max-w-[340px] bg-white border-r shadow-xl animate-slideIn">
        <div class="flex items-center justify-between px-4 py-4 border-b">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-brand-600 text-white grid place-items-center font-bold">tb</div>
            <div class="font-semibold">thynkBarber</div>
          </div>
          <button class="tap p-2 rounded-xl border hover:bg-slate-50" data-close-sheet aria-label="Fechar">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <nav class="p-3 text-sm">
          <div class="px-3 py-2 text-slate-400 uppercase tracking-wide">Administrativo</div>
          <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-speedometer2"></i><span>Dashboard</span>
          </a>
          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Agendamentos</div>
          <a href="agenda.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-calendar3"></i><span>Agendamentos</span>
          </a>
          <a href="historico.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-clock-history"></i><span>Histórico</span>
          </a>
          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Finanças</div>
          <a href="faturamento.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-wallet2"></i><span>Faturamento</span>
          </a>
          <a href="metas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bullseye"></i><span>Metas</span>
          </a>
          <a href="vendas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl bg-brand-50 text-brand-800 border border-brand-100">
            <i class="bi bi-bag"></i><span>Vendas</span>
          </a>
        </nav>
      </div>
    </div>

    <!-- MAIN -->
    <main class="flex-1 min-h-screen lg:ml-72">
      <section class="p-3 lg:p-6">
        <div class="grid lg:grid-cols-12 gap-4">
          <!-- FORM -->
          <div class="lg:col-span-7">
            <div class="p-4 md:p-5 border rounded-2xl bg-white shadow-soft">
              <div class="flex items-center justify-between">
                <div class="font-medium">Cadastrar venda</div>
                <span class="text-xs text-slate-500">Campos obrigatórios *</span>
              </div>

              <!-- Tabs -->
              <div class="mt-4 grid grid-cols-2 gap-2">
                <button id="tabProduct" class="px-3 py-2 rounded-xl border bg-brand-50 text-brand-800 border-brand-200"><i class="bi bi-bag me-1"></i>Produto</button>
                <button id="tabSub" class="px-3 py-2 rounded-xl border hover:bg-slate-50"><i class="bi bi-person-badge me-1"></i>Assinatura</button>
              </div>

              <!-- Alertas -->
              <div id="alert" class="hidden mt-3 p-3 border rounded-xl bg-rose-50 text-rose-800 text-sm"></div>
              <div id="toast" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 px-3 py-2 rounded-xl bg-emerald-600 text-white shadow-soft">Venda registrada!</div>

              <!-- Cliente & data -->
              <div class="mt-4 grid grid-cols-2 gap-2">
                <label class="text-sm col-span-2">
                  Cliente *
                  <input id="fClient" class="mt-1 w-full border rounded-xl px-3 py-2" placeholder="Nome do cliente" list="clientsList" autocomplete="name" />
                  <datalist id="clientsList"></datalist>
                </label>
                <label class="text-sm">
                  Data *
                  <input id="fDate" type="date" class="mt-1 w-full border rounded-xl px-3 py-2" />
                </label>
                <label class="text-sm">
                  Pagamento *
                  <select id="fPay" class="mt-1 w-full border rounded-xl px-3 py-2">
                    <option value="pix">PIX</option>
                    <option value="card">Cartão</option>
                    <option value="cash">Dinheiro</option>
                  </select>
                </label>
              </div>

              <!-- Produto -->
              <div id="boxProduct" class="mt-4">
                <div class="grid grid-cols-2 gap-2">
                  <label class="text-sm col-span-2">
                    Produto *
                    <select id="pProduct" class="mt-1 w-full border rounded-xl px-3 py-2"></select>
                  </label>
                  <label class="text-sm">
                    Preço unitário (R$) *
                    <input id="pPrice" type="number" inputmode="decimal" step="0.01" class="mt-1 w-full border rounded-xl px-3 py-2" />
                  </label>
                  <label class="text-sm">
                    Quantidade *
                    <div class="mt-1 flex items-stretch rounded-xl border overflow-hidden">
                      <button type="button" id="qtyMinus" class="px-3 tap">−</button>
                      <input id="pQty" type="number" min="1" step="1" class="w-full px-3 py-2 text-center" value="1" />
                      <button type="button" id="qtyPlus" class="px-3 tap">+</button>
                    </div>
                  </label>
                  <label class="text-sm col-span-2">
                    Desconto
                    <div class="mt-1 grid grid-cols-3 gap-2">
                      <input id="pDiscount" type="number" inputmode="decimal" step="0.01" min="0" class="col-span-2 w-full border rounded-xl px-3 py-2" placeholder="0,00" />
                      <select id="pDiscountType" class="w-full border rounded-xl px-3 py-2">
                        <option value="amount">R$</option>
                        <option value="percent">%</option>
                      </select>
                    </div>
                  </label>
                  <label class="text-sm col-span-2">
                    Observações
                    <textarea id="pNotes" rows="3" class="mt-1 w-full border rounded-xl px-3 py-2" placeholder="Observações da venda"></textarea>
                  </label>
                </div>
              </div>

              <!-- Assinatura -->
              <div id="boxSub" class="mt-4 hidden">
                <div class="grid grid-cols-2 gap-2">
                  <label class="text-sm col-span-2">
                    Plano *
                    <select id="sPlan" class="mt-1 w-full border rounded-xl px-3 py-2"></select>
                  </label>
                  <label class="text-sm">
                    Preço (R$) *
                    <input id="sPrice" type="number" inputmode="decimal" step="0.01" class="mt-1 w-full border rounded-xl px-3 py-2" />
                  </label>
                  <label class="text-sm">
                    Duração (meses)
                    <input id="sMonths" type="number" min="1" step="1" class="mt-1 w-full border rounded-xl px-3 py-2" value="1" />
                  </label>
                  <label class="text-sm col-span-2">
                    Observações
                    <textarea id="sNotes" rows="3" class="mt-1 w-full border rounded-xl px-3 py-2" placeholder="Observações da assinatura"></textarea>
                  </label>
                </div>
              </div>

              <!-- Ações -->
              <div class="mt-4 flex items-center gap-2">
                <button id="btnClear" class="px-3 py-2 border rounded-xl">Limpar</button>
                <button id="btnSave" class="ml-auto px-3 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-xl"><i class="bi bi-check2 me-1"></i>Registrar venda</button>
              </div>
            </div>
          </div>

          <!-- RESUMO + RECENTES -->
          <div class="lg:col-span-5">
            <div class="p-4 md:p-5 border rounded-2xl bg-white shadow-soft">
              <div class="font-medium">Resumo</div>
              <div class="grid grid-cols-2 gap-2 mt-3">
                <div class="p-3 border rounded-xl bg-brand-50 border-brand-100">
                  <div class="text-xs text-brand-800">Subtotal</div>
                  <div id="sumSubtotal" class="text-lg font-semibold">R$ 0,00</div>
                </div>
                <div class="p-3 border rounded-xl">
                  <div class="text-xs text-slate-500">Desconto</div>
                  <div id="sumDiscount" class="text-lg font-semibold">R$ 0,00</div>
                </div>
                <div class="p-3 border rounded-xl col-span-2">
                  <div class="text-xs text-slate-500">Total</div>
                  <div id="sumTotal" class="text-2xl font-semibold">R$ 0,00</div>
                </div>
              </div>
              <div class="mt-4 text-xs text-slate-500">O total considera as informações do formulário atual.</div>
            </div>

            <div class="p-4 md:p-5 border rounded-2xl bg-white shadow-soft mt-4">
              <div class="flex items-center justify-between">
                <div class="font-medium">Vendas recentes</div>
                <button id="refreshRecent" class="px-3 py-2 border rounded-xl text-sm"><i class="bi bi-arrow-repeat me-1"></i>Atualizar</button>
              </div>
              <div id="recentList" class="mt-3 space-y-2"></div>
              <div id="emptyRecent" class="p-6 text-center text-slate-500 border rounded-2xl hidden">Sem vendas registradas ainda.</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- =================== JS =================== -->
  <script>
    /* ======= Mock data (pronto pra plugar no back-end) ======= */
    const BARBER = { id:'b1', name:'Carlos Silva' };
    const CLIENTS = [
      { id:'c1', name:'João Pedro', phone:'+55 11 90000-0001' },
      { id:'c2', name:'Matheus Lima', phone:'+55 11 90000-0002' },
      { id:'c3', name:'Rafael Souza', phone:'+55 11 90000-0003' },
    ];
    const PRODUCTS = [
      { id:'p1', name:'Pomada Modeladora', price:49.90 },
      { id:'p2', name:'Óleo para Barba', price:39.90 },
      { id:'p3', name:'Shampoo Fresh', price:34.90 },
      { id:'p4', name:'Balm Pós-barba', price:29.90 },
    ];
    const PLANS = [
      { id:'s1', name:'Plano Mensal', price:89.90, months:1 },
      { id:'s2', name:'Plano Trimestral', price:249.90, months:3 },
      { id:'s3', name:'Plano Semestral', price:469.90, months:6 },
    ];
    let SALES = [];

    /* ======= Helpers ======= */
    const $ = sel => document.querySelector(sel);
    const currency = v => (v||0).toLocaleString('pt-BR',{ style:'currency', currency:'BRL' });
    const todayISO = () => new Date().toISOString().slice(0,10);

    function findClientByName(name){ return CLIENTS.find(c=> (c.name||'').toLowerCase()===String(name||'').toLowerCase()); }

    /* ======= Sidebar mobile ======= */
    $('#openSidebar')?.addEventListener('click', ()=> $('#sidebarSheet').classList.remove('hidden'));
    document.querySelectorAll('[data-close-sheet]').forEach(b=> b.addEventListener('click', ()=> $('#sidebarSheet').classList.add('hidden')));

    /* ======= UI State (tabs) ======= */
    const tabProduct = $('#tabProduct');
    const tabSub = $('#tabSub');
    const boxProduct = $('#boxProduct');
    const boxSub = $('#boxSub');

    tabProduct.addEventListener('click', ()=>{
      tabProduct.className='px-3 py-2 rounded-xl border bg-brand-50 text-brand-800 border-brand-200';
      tabSub.className='px-3 py-2 rounded-xl border hover:bg-slate-50';
      boxProduct.classList.remove('hidden');
      boxSub.classList.add('hidden');
      computeSummary();
    });
    tabSub.addEventListener('click', ()=>{
      tabSub.className='px-3 py-2 rounded-xl border bg-brand-50 text-brand-800 border-brand-200';
      tabProduct.className='px-3 py-2 rounded-xl border hover:bg-slate-50';
      boxSub.classList.remove('hidden');
      boxProduct.classList.add('hidden');
      computeSummary();
    });

    /* ======= Populate form ======= */
    function loadClients(){ const dl = $('#clientsList'); dl.innerHTML=''; CLIENTS.forEach(c=>{ const o=document.createElement('option'); o.value=c.name; dl.appendChild(o); }); }
    function loadProducts(){ const sel = $('#pProduct'); sel.innerHTML=''; PRODUCTS.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.name} — ${currency(p.price)}`; sel.appendChild(o); }); if(PRODUCTS[0]){ $('#pProduct').value=PRODUCTS[0].id; $('#pPrice').value=PRODUCTS[0].price; } }
    function loadPlans(){ const sel = $('#sPlan'); sel.innerHTML=''; PLANS.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.name} — ${currency(p.price)}`; sel.appendChild(o); }); if(PLANS[0]){ $('#sPlan').value=PLANS[0].id; $('#sPrice').value=PLANS[0].price; $('#sMonths').value=PLANS[0].months; } }

    /* ======= Events ======= */
    $('#pProduct').addEventListener('change', ()=>{ const p = PRODUCTS.find(x=> x.id === $('#pProduct').value); if(p){ $('#pPrice').value = p.price; } computeSummary(); });
    ['pPrice','pQty','pDiscount','pDiscountType','sPrice','sMonths','fPay'].forEach(id=>{ $('#'+id).addEventListener('input', computeSummary); });
    $('#qtyMinus').addEventListener('click', ()=>{ const v=Math.max(1, parseInt($('#pQty').value||1,10)-1); $('#pQty').value=v; computeSummary(); });
    $('#qtyPlus').addEventListener('click', ()=>{ const v=Math.max(1, parseInt($('#pQty').value||1,10)+1); $('#pQty').value=v; computeSummary(); });

    $('#btnClear').addEventListener('click', ()=> resetForm());
    $('#btnSave').addEventListener('click', ()=> saveSale());
    $('#refreshRecent').addEventListener('click', ()=> renderRecent());

    /* ======= Summary ======= */
    function computeSummary(){
      const isProduct = !boxProduct.classList.contains('hidden');
      let subtotal=0, discount=0, total=0;
      if(isProduct){
        const price = parseFloat($('#pPrice').value||0);
        const qty   = parseInt($('#pQty').value||1,10);
        const disc  = parseFloat($('#pDiscount').value||0);
        const dtype = $('#pDiscountType').value;
        subtotal = price * qty;
        discount = dtype==='percent' ? Math.min(subtotal, subtotal * (disc/100)) : Math.min(subtotal, disc);
        total = subtotal - discount;
      } else {
        const price = parseFloat($('#sPrice').value||0);
        subtotal = price; total = price; discount = 0;
      }
      $('#sumSubtotal').textContent = currency(subtotal);
      $('#sumDiscount').textContent = (discount>0?'- ':'') + currency(discount);
      $('#sumTotal').textContent = currency(total);
    }

    /* ======= Save ======= */
    function showAlert(msg){ const a=$('#alert'); a.textContent=msg; a.classList.remove('hidden'); setTimeout(()=> a.classList.add('hidden'), 3500); }
    function showToast(){ const t=$('#toast'); t.classList.remove('hidden'); setTimeout(()=> t.classList.add('hidden'), 1600); }

    async function saveSale(){
      const clientName = ($('#fClient').value||'').trim();
      const client = findClientByName(clientName);
      if(!client){ showAlert('Selecione/informe um cliente válido.'); return; }
      const date = $('#fDate').value || todayISO();
      const pay  = $('#fPay').value;

      const isProduct = !boxProduct.classList.contains('hidden');
      let payload;
      if(isProduct){
        const pid = $('#pProduct').value; const product = PRODUCTS.find(p=> p.id===pid);
        const price = parseFloat($('#pPrice').value||0);
        const qty = parseInt($('#pQty').value||1,10);
        const discount = parseFloat($('#pDiscount').value||0);
        const discountType = $('#pDiscountType').value;
        const notes = $('#pNotes').value||'';
        if(!product){ showAlert('Selecione um produto.'); return }
        if(price<=0 || qty<=0){ showAlert('Preço e quantidade devem ser maiores que zero.'); return }
        payload = { barberId:BARBER.id, date, type:'product', clientId:client.id, productId:pid, price, qty, discount, discountType, pay, notes };
      } else {
        const sid = $('#sPlan').value; const plan = PLANS.find(p=> p.id===sid);
        const price = parseFloat($('#sPrice').value||0);
        const months = parseInt($('#sMonths').value||1,10);
        const notes = $('#sNotes').value||'';
        if(!plan){ showAlert('Selecione um plano.'); return }
        if(price<=0){ showAlert('Preço precisa ser maior que zero.'); return }
        payload = { barberId:BARBER.id, date, type:'subscription', clientId:client.id, planId:sid, price, months, pay, notes };
      }

      try{
        const r = await fetch('/api/sales', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        if(!r.ok) throw 0; const saved = await r.json();
        SALES.unshift(saved);
      }catch{
        // fallback local
        const id = 'sv'+(SALES.length+1);
        const total = calcTotalFromPayload(payload);
        const desc = payload.type==='product' ? `${(PRODUCTS.find(p=>p.id===payload.productId)?.name)||'Produto'} x${payload.qty}` : `${(PLANS.find(p=>p.id===payload.planId)?.name)||'Assinatura'} (${payload.months||1}m)`;
        SALES.unshift({ id, ...payload, total, client: CLIENTS.find(c=>c.id===payload.clientId)?.name, desc });
      }

      showToast();
      resetForm();
      renderRecent();
    }

    function calcTotalFromPayload(p){
      if(p.type==='product'){
        const subtotal = p.price * p.qty;
        const discount = p.discountType==='percent' ? (subtotal * (p.discount||0)/100) : (p.discount||0);
        return Math.max(0, subtotal - Math.min(subtotal, discount));
      }
      if(p.type==='subscription'){ return p.price; }
      return 0;
    }

    function resetForm(){
      $('#alert').classList.add('hidden');
      // cliente
      $('#fClient').value = '';
      $('#fDate').value = todayISO();
      $('#fPay').value = 'pix';
      // produto
      if(PRODUCTS[0]){ $('#pProduct').value=PRODUCTS[0].id; $('#pPrice').value=PRODUCTS[0].price; }
      $('#pQty').value=1; $('#pDiscount').value=''; $('#pDiscountType').value='amount'; $('#pNotes').value='';
      // plano
      if(PLANS[0]){ $('#sPlan').value=PLANS[0].id; $('#sPrice').value=PLANS[0].price; $('#sMonths').value=PLANS[0].months; $('#sNotes').value=''; }
      // voltar para Produto por padrão
      tabProduct.click();
      computeSummary();
    }

    /* ======= Recent list ======= */
    function renderRecent(){
      const cont = $('#recentList'); cont.innerHTML='';
      if(SALES.length===0){ $('#emptyRecent').classList.remove('hidden'); return } else { $('#emptyRecent').classList.add('hidden'); }
      SALES.slice(0,8).forEach((s,i)=>{
        const row = document.createElement('div'); row.className='p-3 border rounded-2xl bg-white shadow-soft animate-fadeUp'; row.style.animationDelay=`${i*0.02}s`;
        const typeChip = s.type==='product' ? 'bg-indigo-50 text-indigo-800 border-indigo-200' : 'bg-amber-50 text-amber-800 border-amber-200';
        row.innerHTML = `
          <div class='flex items-center justify-between'>
            <div class='text-xs text-slate-500'>${(s.date||'').split('-').reverse().join('/')}</div>
            <span class='px-2 py-0.5 text-xs rounded-xl border ${typeChip}'>${ s.type==='product' ? 'Produto' : 'Assinatura' }</span>
          </div>
          <div class='mt-2 flex items-center gap-3'>
            <div class='w-10 h-10 rounded-full grid place-items-center text-brand-800 border' style='background:rgba(74,130,255,.08); border-color:rgba(74,130,255,.25)'>${(s.client||'?').split(' ').map(p=>p[0]).slice(0,2).join('')}</div>
            <div class='min-w-0'>
              <div class='font-medium truncate'>${s.client||'Cliente'}</div>
              <div class='text-sm text-slate-500 truncate'>${s.desc || (s.type==='product' ? 'Produto' : 'Assinatura')}</div>
            </div>
            <div class='ml-auto text-right'>
              <div class='text-sm'>${currency(s.total ?? calcTotalFromPayload(s))}</div>
              <div class='text-xs text-slate-500'>${ s.pay==='pix' ? 'PIX' : s.pay==='card' ? 'Cartão' : 'Dinheiro' }</div>
            </div>
          </div>`;
        cont.appendChild(row);
      });
    }

    /* ======= Init ======= */
    function init(){
      document.getElementById('barberName').textContent = BARBER.name;
      loadClients(); loadProducts(); loadPlans();
      $('#fDate').value = todayISO();
      computeSummary();
      renderRecent();
    }
    init();
  </script>
</body>
</html>
