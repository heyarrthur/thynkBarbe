<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>thynkBarber • Histórico (Barbeiro)</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              25:'#f8faff',50:'#f3f7ff',100:'#e6efff',200:'#d8e6ff',300:'#b9d0ff',
              400:'#93b4ff',500:'#4a82ff',600:'#3a6af4',700:'#2e54c6',800:'#2746a3',900:'#203a85'
            }
          },
          boxShadow:{ soft:'0 1px 2px rgba(16,24,40,.04), 0 6px 18px rgba(16,24,40,.08)' },
          borderRadius:{ '2xl':'1rem' },
          keyframes:{
            fadeUp:{ from:{opacity:0, transform:'translateY(6px)'}, to:{opacity:1, transform:'translateY(0)'} },
            slideIn:{ from:{transform:'translateX(100%)'}, to:{transform:'translateX(0)'} }
          },
          animation:{ fadeUp:'fadeUp .28s ease both', slideIn:'slideIn .25s ease both' }
        }
      }
    }
  </script>

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    *{ box-sizing:border-box }
    html, body{ overflow-x:hidden; background:#fff }
    .no-scrollbar::-webkit-scrollbar{ display:none }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none }
    .tap{ min-height:44px; min-width:44px }
  </style>
</head>
<body class="bg-white text-slate-800">

  <!-- TOPBAR (mobile) -->
  <header class="lg:hidden sticky top-0 z-50 bg-white/80 backdrop-blur border-b">
    <div class="flex items-center gap-2 p-3">
      <button id="openSidebar" class="tap p-2 rounded-xl border hover:bg-slate-50" aria-label="Abrir menu">
        <i class="bi bi-list"></i>
      </button>
      <div class="font-medium">Histórico</div>
      <div class="ml-auto text-xs px-2 py-1 rounded bg-slate-100">Light</div>
    </div>
  </header>

  <div class="flex">
    <!-- SIDEBAR (desktop fixa) -->
    <aside class="hidden lg:flex lg:fixed lg:inset-y-0 lg:left-0 lg:w-72 border-r bg-white z-40">
      <div class="flex-1 flex flex-col">
        <div class="px-5 py-5 border-b flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-brand-600 text-white grid place-items-center font-bold">tb</div>
          <div>
            <div class="font-bold">thynkBarber</div>
            <div class="text-xs text-slate-500">Painel do Barbeiro</div>
          </div>
        </div>
        <nav class="px-3 py-3 text-sm overflow-y-auto">
          <div class="px-3 py-2 text-slate-400 uppercase tracking-wide">Administrativo</div>
          <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-speedometer2"></i><span>Dashboard</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Agendamentos</div>
          <a href="agenda.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-calendar3"></i><span>Agenda</span>
          </a>
          <a href="historico.html" class="flex items-center gap-3 px-3 py-2 rounded-xl bg-brand-50 text-brand-800 border border-brand-100">
            <i class="bi bi-clock-history"></i><span>Histórico</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Finanças</div>
          <a href="faturamento.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-wallet2"></i><span>Faturamento</span>
          </a>
          <a href="metas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bullseye"></i><span>Metas</span>
          </a>
          <a href="vendas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bag"></i><span>Vendas</span>
          </a>

          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Perfil</div>
          <div class="mx-3 p-3 border rounded-xl bg-slate-50">
            <div class="text-xs text-slate-500">Barbeiro</div>
            <div id="barberName" class="font-medium">—</div>
          </div>
        </nav>
      </div>
    </aside>

    <!-- SIDEBAR (mobile offcanvas) -->
    <div id="sidebarSheet" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-black/40" data-close-sheet></div>
      <div class="absolute left-0 top-0 h-full w-[92%] max-w-[340px] bg-white border-r shadow-xl animate-slideIn">
        <div class="flex items-center justify-between px-4 py-4 border-b">
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-brand-600 text-white grid place-items-center font-bold">tb</div>
            <div class="font-semibold">thynkBarber</div>
          </div>
          <button class="tap p-2 rounded-xl border hover:bg-slate-50" data-close-sheet aria-label="Fechar">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <nav class="p-3 text-sm">
          <div class="px-3 py-2 text-slate-400 uppercase tracking-wide">Administrativo</div>
          <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-speedometer2"></i><span>Dashboard</span>
          </a>
          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Agendamentos</div>
          <a href="agenda.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-calendar3"></i><span>Agenda</span>
          </a>
          <a href="historico.html" class="flex items-center gap-3 px-3 py-2 rounded-xl bg-brand-50 text-brand-800 border border-brand-100">
            <i class="bi bi-clock-history"></i><span>Histórico</span>
          </a>
          <div class="px-3 pt-4 pb-2 text-slate-400 uppercase tracking-wide">Finanças</div>
          <a href="faturamento.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-wallet2"></i><span>Faturamento</span>
          </a>
          <a href="metas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bullseye"></i><span>Metas</span>
          </a>
          <a href="vendas.html" class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-slate-50">
            <i class="bi bi-bag"></i><span>Vendas</span>
          </a>
        </nav>
      </div>
    </div>

    <!-- MAIN -->
    <main class="flex-1 min-h-screen lg:ml-72">
      <!-- CONTROLES (mobile sticky) -->
      <div class="lg:hidden sticky top-[49px] z-40 bg-white border-b">
        <div class="flex items-center gap-2 p-2">
          <button id="mPrev" class="tap p-2 rounded-xl border hover:bg-slate-50" aria-label="Dia anterior"><i class="bi bi-chevron-left"></i></button>
          <button id="mToday" class="tap p-2 rounded-xl border hover:bg-slate-50" aria-label="Hoje"><i class="bi bi-calendar3"></i></button>
          <div id="mobileDateLabel" class="flex-1 text-center font-medium">—</div>
          <button id="mNext" class="tap p-2 rounded-xl border hover:bg-slate-50" aria-label="Próximo dia"><i class="bi bi-chevron-right"></i></button>
        </div>
      </div>

      <!-- FILTROS -->
      <section class="px-3 lg:px-6 py-3 border-b bg-white">
        <div class="grid grid-cols-2 md:grid-cols-7 gap-2">
          <input id="fDate" type="date" class="border rounded-xl px-3 py-2 text-sm" />
          <input id="fClient" class="col-span-1 md:col-span-2 border rounded-xl px-3 py-2 text-sm" placeholder="Buscar cliente…" />
          <select id="fService" class="border rounded-xl px-3 py-2 text-sm">
            <option value="">Todos os serviços</option>
          </select>
          <select id="fStatus" class="border rounded-xl px-3 py-2 text-sm">
            <option value="">Todos os status</option>
            <option value="done">Concluído</option>
            <option value="canceled">Cancelado</option>
            <option value="noshow">No-show</option>
          </select>
          <button id="btnClear" class="px-3 py-2 border rounded-xl text-sm"><i class="bi bi-x-circle me-1"></i>Limpar</button>
          <button id="btnExport" class="px-3 py-2 border rounded-xl text-sm"><i class="bi bi-download me-1"></i>CSV</button>
        </div>
      </section>

      <!-- LISTA (cards responsivos) -->
      <section class="p-3 lg:p-6">
        <div class="p-3 md:p-4 border rounded-2xl bg-white shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-medium">Histórico do dia</div>
            <div id="dayLabel" class="text-xs text-slate-500">—</div>
          </div>
          <div id="histList" class="mt-3 space-y-2"></div>
          <div id="emptyState" class="hidden p-6 text-center text-slate-500 border rounded-2xl">Nada encontrado para este filtro.</div>
        </div>
      </section>
    </main>
  </div>

  <!-- SHEET DETALHES (read-only) -->
  <div id="sheet" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/40" data-close-sheet></div>
    <div class="absolute right-0 top-0 h-full w-full sm:w-[520px] bg-white shadow-xl flex flex-col rounded-l-2xl animate-slideIn">
      <div class="px-4 py-3 border-b flex items-center justify-between">
        <div class="font-semibold">Detalhes</div>
        <button class="tap p-2 rounded-xl border hover:bg-slate-50" data-close-sheet aria-label="Fechar"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="flex-1 overflow-y-auto p-4" id="sheetContent"></div>
      <div class="border-t p-3 flex gap-2 bg-white">
        <button class="px-3 py-2 border rounded-xl" data-close-sheet>Fechar</button>
      </div>
    </div>
  </div>

  <!-- =================== JS =================== -->
  <script>
    /* ======= Mock / pronto para backend ======= */
    const BARBER = { id:'b1', name:'Carlos Silva' };
    const SERVICES = [
      { id:'cut', name:'Corte', price:55, color:'#4a82ff' },
      { id:'beard', name:'Barba', price:40, color:'#22c55e' },
      { id:'combo', name:'Combo', price:85, color:'#f59e0b' },
      { id:'color', name:'Coloração', price:120, color:'#ef4444' },
    ];
    const CLIENTS = [
      { id:'c1', name:'João Pedro', phone:'+55 11 90000-0001', member:true },
      { id:'c2', name:'Matheus Lima', phone:'+55 11 90000-0002', member:false },
      { id:'c3', name:'Rafael Souza', phone:'+55 11 90000-0003', member:true },
    ];
    const TODAY = '2025-10-15';
    const HISTORY = [
      { id:'h1', date:'2025-10-15', time:'09:00', duration:40, clientId:'c1', serviceId:'cut', status:'done',   paid:55, notes:'Degradê baixo' },
      { id:'h2', date:'2025-10-15', time:'10:30', duration:30, clientId:'c2', serviceId:'beard', status:'done', paid:40, notes:'Toalha quente' },
      { id:'h3', date:'2025-10-15', time:'12:00', duration:70, clientId:'c3', serviceId:'combo', status:'canceled', paid:0, notes:'Cliente avisou' },
      { id:'h4', date:'2025-10-14', time:'17:00', duration:40, clientId:'c1', serviceId:'cut', status:'done',   paid:55, notes:'' },
      { id:'h5', date:'2025-10-13', time:'11:00', duration:30, clientId:'c2', serviceId:'beard', status:'noshow',paid:0, notes:'Não atendeu' },
    ];

    /* ======= Utils ======= */
    const $ = sel => document.querySelector(sel);
    const pad = n=> String(n).padStart(2,'0');
    const currency = v => v.toLocaleString('pt-BR',{ style:'currency', currency:'BRL' });
    const fmtDate = s => s.split('-').reverse().join('/');
    const addDays = (s, n)=>{ const d=new Date(s); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10) };

    /* ======= Sidebar mobile ======= */
    $('#openSidebar')?.addEventListener('click', ()=> $('#sidebarSheet').classList.remove('hidden'));
    document.querySelectorAll('[data-close-sheet]').forEach(b=> b.addEventListener('click', ()=> $('#sidebarSheet').classList.add('hidden')));

    /* ======= Filtros ======= */
    const fDate = $('#fDate');
    const fClient = $('#fClient');
    const fService = $('#fService');
    const fStatus = $('#fStatus');

    function loadServiceFilter(){ SERVICES.forEach(s=>{ const o=document.createElement('option'); o.value=s.id; o.textContent=s.name; fService.appendChild(o); }); }

    [fDate, fClient, fService, fStatus].forEach(el=> el.addEventListener('input', renderList));
    $('#btnClear').addEventListener('click', ()=>{ fDate.value=TODAY; fClient.value=''; fService.value=''; fStatus.value=''; renderList(); });

    // Mobile prev/next/today
    $('#mToday').addEventListener('click', ()=>{ fDate.value=TODAY; renderList(); });
    $('#mPrev').addEventListener('click', ()=>{ fDate.value = addDays(fDate.value||TODAY, -1); renderList(); });
    $('#mNext').addEventListener('click', ()=>{ fDate.value = addDays(fDate.value||TODAY, 1); renderList(); });

    /* ======= Lookup ======= */
    const getClient = id => CLIENTS.find(c=> c.id===id);
    const getService = id => SERVICES.find(s=> s.id===id);

    /* ======= Export ======= */
    function toCSV(rows){
      const head = 'Data,Hora,Cliente,Serviço,Status,Valor';
      const body = rows.map(r=> [r.date, r.time, getClient(r.clientId)?.name||'', getService(r.serviceId)?.name||'', r.status, r.paid].join(','));
      return [head, ...body].join('\n');
    }
    $('#btnExport').addEventListener('click', ()=>{
      const rows = filterRows();
      const blob = new Blob([toCSV(rows)], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download=`historico_${fDate.value||TODAY}.csv`; a.click(); URL.revokeObjectURL(url);
    });

    /* ======= Filtro aplicado ======= */
    function filterRows(){
      const date = fDate.value || TODAY;
      const q = (fClient.value||'').toLowerCase();
      let rows = HISTORY.filter(r=> r.date===date);
      if(q) rows = rows.filter(r=> (getClient(r.clientId)?.name||'').toLowerCase().includes(q));
      if(fService.value) rows = rows.filter(r=> r.serviceId===fService.value);
      if(fStatus.value) rows = rows.filter(r=> r.status===fStatus.value);
      rows.sort((a,b)=> a.time.localeCompare(b.time));
      return rows;
    }

    /* ======= Render ======= */
    function statusPill(st){
      if(st==='done') return "bg-emerald-50 text-emerald-800 border-emerald-200";
      if(st==='canceled') return "bg-rose-50 text-rose-800 border-rose-200";
      if(st==='noshow') return "bg-amber-50 text-amber-800 border-amber-200";
      return "bg-slate-50 text-slate-700 border-slate-200";
    }

    function renderList(){
      const date = fDate.value || TODAY;
      $('#dayLabel').textContent = new Date(date).toLocaleDateString('pt-BR', { weekday:'long', day:'2-digit', month:'2-digit', year:'numeric' });
      $('#mobileDateLabel').textContent = new Date(date).toLocaleDateString('pt-BR',{weekday:'short', day:'2-digit', month:'2-digit'});

      const cont = $('#histList'); cont.innerHTML='';
      const rows = filterRows();
      $('#emptyState').classList.toggle('hidden', rows.length>0);
      if(rows.length===0) return;

      rows.forEach((r,i)=>{
        const c=getClient(r.clientId); const s=getService(r.serviceId);
        const row=document.createElement('div'); row.className='p-3 border rounded-2xl bg-white shadow-soft animate-fadeUp'; row.style.animationDelay=`${i*0.02}s`;
        row.innerHTML = `
          <div class='flex items-center justify-between'>
            <div class='text-xs text-slate-500'>${fmtDate(r.date)} • ${r.time} • ${r.duration} min</div>
            <span class='px-2 py-0.5 text-xs rounded-xl border ${statusPill(r.status)}'>${ r.status==='done'?'Concluído': r.status==='canceled'?'Cancelado':'No-show' }</span>
          </div>
          <div class='mt-2 flex items-center gap-3'>
            <div class='w-10 h-10 rounded-full grid place-items-center text-brand-800 border' style='background:rgba(74,130,255,.08); border-color:rgba(74,130,255,.25)'>${c.name.split(' ').map(p=>p[0]).slice(0,2).join('')}</div>
            <div class='min-w-0'>
              <div class='font-medium truncate'>${c.name} ${c.member?`<span class='ml-2 px-2 py-0.5 text-[11px] rounded-xl bg-brand-50 text-brand-800 border border-brand-100'>Assinante</span>`:''}</div>
              <div class='text-sm text-slate-500'>${s.name}</div>
            </div>
            <div class='ml-auto text-right'>
              <div class='text-sm'>${currency(r.paid||0)}</div>
              <button class='mt-1 px-2 py-1 rounded-xl border hover:bg-slate-50 text-xs' data-open='${r.id}'><i class='bi bi-eye me-1'></i>Ver</button>
            </div>
          </div>`;
        cont.appendChild(row);
      });

      document.querySelectorAll('[data-open]').forEach(b=> b.addEventListener('click', ()=> openSheet(b.getAttribute('data-open'))));
    }

    /* ======= Sheet Detalhes ======= */
    const sheet = document.getElementById('sheet');
    function openSheet(id){
      const r = HISTORY.find(x=> x.id===id); const c=getClient(r.clientId); const s=getService(r.serviceId);
      document.getElementById('sheetContent').innerHTML = `
        <div class='flex items-center gap-3'>
          <div class='w-12 h-12 rounded-full grid place-items-center text-brand-800 border' style='background:rgba(74,130,255,.08); border-color:rgba(74,130,255,.25)'>${c.name.split(' ').map(p=>p[0]).slice(0,2).join('')}</div>
          <div>
            <div class='font-semibold'>${c.name} ${c.member?`<span class=\"ml-2 px-2 py-0.5 text-xs rounded-xl bg-brand-50 text-brand-800 border border-brand-100\">Assinante</span>`:''}</div>
            <div class='text-xs text-slate-500'>${c.phone||'—'}</div>
          </div>
          <span class='ml-auto px-2 py-0.5 text-xs rounded-xl border ${statusPill(r.status)}'>${ r.status==='done'?'Concluído': r.status==='canceled'?'Cancelado':'No-show' }</span>
        </div>
        <div class='grid grid-cols-2 gap-3 mt-3'>
          <div class='p-3 border rounded-xl'><div class='text-xs text-slate-500'>Data</div><div class='font-medium'>${fmtDate(r.date)}</div></div>
          <div class='p-3 border rounded-xl'><div class='text-xs text-slate-500'>Horário</div><div class='font-medium'>${r.time} • ${r.duration} min</div></div>
          <div class='col-span-2 p-3 border rounded-xl'><div class='text-xs text-slate-500'>Serviço</div><div class='font-medium'><span class='inline-block w-2 h-2 rounded-full mr-2' style='background:${s.color}'></span>${s.name}</div></div>
          <div class='col-span-2 p-3 border rounded-xl'><div class='text-xs text-slate-500'>Valor pago</div><div class='font-semibold'>${currency(r.paid||0)}</div></div>
        </div>
        <div class='p-3 border rounded-xl mt-3'>
          <div class='text-sm font-medium mb-2'>Observações</div>
          <div class='text-sm'>${r.notes||'—'}</div>
        </div>`;
      sheet.classList.remove('hidden');
      document.querySelectorAll('[data-close-sheet]').forEach(b=> b.onclick = ()=> sheet.classList.add('hidden'));
    }

    /* ======= Init ======= */
    function init(){
      document.getElementById('barberName').textContent = BARBER.name;
      loadServiceFilter();
      document.getElementById('fDate').value = TODAY;
      document.getElementById('mobileDateLabel').textContent = new Date(TODAY).toLocaleDateString('pt-BR',{weekday:'short', day:'2-digit', month:'2-digit'});
      document.getElementById('dayLabel').textContent = new Date(TODAY).toLocaleDateString('pt-BR',{weekday:'long', day:'2-digit', month:'2-digit', year:'numeric'});
      renderList();
    }
    init();
  </script>
</body>
</html>